<head lang="en">

    <meta charset="UTF-8" />
    <title>12. Editor with All Plugins</title>
    <link rel="stylesheet" href="js/plugins/wiki/tui_editor/data/tuidoc-example-style.css" />
    <!-- Editor -->
    <link rel="stylesheet" href="js/plugins/wiki/tui_editor/toastui-editor.css" />
    <!-- Chart -->
    <link rel="stylesheet" href="js/plugins/wiki/tui_chart/toastui-chart.css" />

    <!-- Color syntax -->
    <link
            rel="stylesheet"
            href="js/plugins/wiki/tui_color_picker/tui-color-picker.css"
    />
    <link
            rel="stylesheet"
            href="js/plugins/wiki/tui_editor/plugins/editor-plugin-color-syntax/cdn/toastui-editor-plugin-color-syntax.min.css"
    />
    <!-- Merged Table -->
    <link rel="stylesheet" href="js/plugins/wiki/tui_editor/plugins/editor-plugin-table-merged-cell/cdn/toastui-editor-plugin-table-merged-cell.min.css" />

    <link
            rel="stylesheet"
            href="js/plugins/wiki/tui_editor/plugins/editor-plugin-code-syntax-highlight/cdn/toastui-editor-plugin-code-syntax-highlight.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<link rel="stylesheet" href="css/plugins/wiki/darkmode.css" />
</head>
<div class="row">
    <div class="col-sm-12">
        <div class="container panel panel-default">
            <div class="text-right">
                <#if lastVersion?? >
                <small>${lastVersion.dateEdition} ${lastVersion.userName!''} ${lastVersion.userPseudo!''}
                <img class="avatar-small img-circle" src="${lastVersion.userAvatarUrl!''}" alt="avatar" />
                <#if isExtendInstalled?? && isExtendInstalled >
                    &nbsp;<span class="glyphicon glyphicon-eye-open"></span>
                    @Extender[${topic.idTopic},WIKI,hit,{show:true}]@
                </#if>
                </small>
                </#if>
            </div>
            <div class="btn-group btn-group-xs pull-right">
                <a class="btn btn-default" href="jsp/site/Portal.jsp?page=wiki&view=map" title="#i18n{wiki.menu.map}">
                    <span class="glyphicon glyphicon-list"></span> #i18n{wiki.menu.map}
                </a>
                <button class="btn btn-default" id="btn-search" type="button" title="#i18n{wiki.menu.search}" >
                    <span class="glyphicon glyphicon-search"></span> #i18n{wiki.menu.search}
                </button>
                <a class="btn btn-default" href="jsp/site/Portal.jsp?page=wiki&view=modifyPage&page_name=${topic.pageName}" title="#i18n{wiki.menu.edit}">
                    <span class="glyphicon glyphicon-edit"></span> #i18n{wiki.menu.edit}
                </a>
                <button class="btn btn-default" id="btn-new-page" type="button" title="#i18n{wiki.menu.create}">
                   <span class="glyphicon glyphicon-plus-sign"></span> #i18n{wiki.menu.create}
                </button>
                <a class="btn btn-default" href="jsp/site/Portal.jsp?page=wiki&view=history&page_name=${topic.pageName}" title="#i18n{wiki.menu.history}">
                    <span class="glyphicon glyphicon-time"></span> #i18n{wiki.menu.history}
                </a>
                <#list languages_list as language>
                  <#if language = current_language >
                    <span class="label label-info">${language}</span>
                  <#else>
                        <a class="btn btn-default" href="jsp/site/Portal.jsp?page=wiki&view=page&&page_name=${topic.pageName}&language=${language}">
                            ${language}
                        </a>
                  </#if>
                </#list>
            </div>
<!------------------- DARK MODE -------------------------->
<div id="darkModeSwitch" style="display: none">
    <div  style="display: flex; justify-content: end;  flex-direction: row; margin-top: 15px" >
        <div style="margin-right: 10px">
            <div id="darkModeLabel"><span class="fa fa-sun fa-2x"></span></div>
        </div>
        <label class="switch">
            <input  id="darkModeId"   type="checkbox"  onchange="toggleDarkMode()" >
            <span class="slider round"></span>
        </label>
    </div>
</div>
<!---------------------------------------------->
            <div id="div-new-page" style="display:none">
                <form class="form-search" action="jsp/site/Portal.jsp" method="get" >
                    <input type="hidden" name="page" value="wiki" />
                    <input type="hidden" name="action" value="newPage" />
                    <div class="input-append">
                        <input class="search-query col-sm-4" id="input-new-page" type="text" name="page_name" /> &nbsp;
                        <button class="btn btn-primary btn-xs" type="submit" >
                            <span class="glyphicon glyphicon-plus-sign"></span> #i18n{wiki.list_wiki.create}
                        </button>
                    </div>
                </form>
            </div>

            <div id="div-search" style="display:none">
                <form class="form-search" action="jsp/site/Portal.jsp" method="get">
                    <input type="hidden" name="page" value="wiki" />
                    <input type="hidden" name="view" value="search" />
                    #i18n{wiki.search_wiki.search} :
                    <div class="input-append">
                        <input class="search-query" id="input-search" type="text" name="query" />
                        <button class="btn btn-primary btn-xs" type="submit" >
                            <span class="glyphicon glyphicon-search"></span>
                        </button>
                    </div>
                </form>
            </div>

            <h1 id="wiki-heading">${topic_title}</h1>
            <hr>
            <div >
            ${result}
            </div>

<script type="text/javascript">
    jQuery(document).ready(function() {
        $("#btn-new-page").click(function() {
            $("#div-search").hide();
            $("#div-new-page").show("slow");
            $("#input-new-page").focus();
        });
        $("#btn-search").click(function() {
            $("#div-new-page").hide();
            $("#div-search").show("slow");
            $("#input-search").focus();
        });
    });
</script>


<script defer>
    window.addEventListener("load", (event) => {
        if(document.getElementsByClassName('darkModeClassOn').length > 0){
            document.getElementById('darkModeSwitch').style.display = 'block';
        }
        let darkMode = localStorage.getItem('darkMode');
        let darkModeId = document.getElementById('darkModeId');
        let darkModeLabel = document.getElementById('darkModeLabel');
        if (darkMode === 'true') {
            darkModeId.checked = true;
            darkModeLabel.innerHTML = '<span class="fa fa-moon fa-2x"></span>';
            document.body.classList.add('darkmode');
        } else {
            darkModeId.checked = false;
            darkModeLabel.innerHTML = '<span class="fa fa-sun fa-2x"></span>';
            document.body.classList.remove('darkmode');
        }
    });


    window.addEventListener("load", (event) => {
        if(document.getElementsByClassName('darkModeClassOn').length > 0){
            document.getElementById('darkModeSwitch').style.display = 'block';
        }
        let darkMode = localStorage.getItem('darkMode');
        let darkModeId = document.getElementById('darkModeId');
        let darkModeLabel = document.getElementById('darkModeLabel');
        if (darkMode === 'true') {
            darkModeId.checked = true;
            darkModeLabel.innerHTML = '<span class="fa fa-moon fa-2x"></span>';
            document.body.classList.add('darkmode');
        } else {
            darkModeId.checked = false;
            darkModeLabel.innerHTML = '<span class="fa fa-sun fa-2x"></span>';
            document.body.classList.remove('darkmode');
        }
    });
    function toggleDarkMode() {
        let darkMode = localStorage.getItem('darkMode');
        let darkModeId = document.getElementById('darkModeId');
        let darkModeLabel = document.getElementById('darkModeLabel');
        if (darkMode === 'true') {
            darkModeId.checked = false;
            darkModeLabel.innerHTML = '<span class="fa fa-sun fa-2x"></span>';
            document.body.classList.remove('darkmode');
            localStorage.setItem('darkMode', 'false');
        } else {
            darkModeId.checked = true;
            darkModeLabel.innerHTML = '<span class="fa fa-moon fa-2x"></span>';
            document.body.classList.add('darkmode');
            localStorage.setItem('darkMode', 'true');
        }
    }
    window.addEventListener("load", (event) => {
        // on every tagName "PRE" add a copy button on the top right corner
           var pre = document.getElementsByTagName('pre');
              for (var i = 0; i < pre.length; i++) {
                var button = document.createElement('button');
                button.className = 'btn btn-primary btn-xs';
                button.style.float = 'right';
                button.style.marginTop = '10px';
                button.style.marginRight = '10px';
                button.textContent = 'Copy';
                button.onclick = function() {
                  copyToClipboard(this.nextElementSibling.textContent);
                };
                pre[i].insertAdjacentElement('beforebegin', button)
              }
    });

    function copyToClipboard(text) {
        var dummy = document.createElement('textarea');
        document.body.appendChild(dummy);
        dummy.value = text;
        dummy.select();
        document.execCommand('copy');
        document.body.removeChild(dummy);
        }
</script>
